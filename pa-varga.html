<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pa Varga - Labial Consonants | Devanagari Learning Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="lesson.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="logo"><a href="index.html" style="color: white; text-decoration: none;">‡§¶‡•á‡§µ‡§®‡§æ‡§ó‡§∞‡•Ä Learning Hub</a></h1>
            <nav class="nav">
                <a href="index.html" class="nav-link">‚Üê Back to Home</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="lesson-header">
                <h1>Pa Varga - Labial Consonants (‡§™ ‡§µ‡§∞‡•ç‡§ó)</h1>
                <p class="lesson-subtitle">Master the easiest consonant series - made with your lips!</p>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" style="width: 0%"></div>
            </div>

            <nav class="lesson-nav">
                <button class="nav-btn" id="prevBtn" disabled>‚Üê Previous</button>
                <span class="lesson-counter">1 of 5</span>
                <button class="nav-btn" id="nextBtn">Next ‚Üí</button>
            </nav>

            <div class="lesson-content" id="lessonContent">
                <!-- Lessons will be dynamically loaded from data.json -->
            </div>

            <div class="lesson-footer">
                <button class="action-btn" id="playAudio">üîä Play Audio</button>
                <button class="action-btn" id="testYourself">üìù Test Yourself</button>
                <button class="action-btn" id="markComplete">‚úì Mark Complete</button>
            </div>
        </div>
    </main>

    <script>
        // Consonant Lesson Navigator (similar to vowel navigator but for consonants)
        class ConsonantLessonNavigator {
            constructor(varganame) {
                this.vargaName = varganame;
                this.currentLesson = 1;
                this.totalLessons = 5;
                this.completed = JSON.parse(localStorage.getItem(`completed_${this.vargaName}`) || '[]');
                this.lessonData = null;
                
                this.initializeElements();
                this.setupEventListeners();
                this.loadLessonData();
            }

            initializeElements() {
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.lessonCounter = document.querySelector('.lesson-counter');
                this.progressFill = document.querySelector('.progress-fill');
                this.lessonContent = document.getElementById('lessonContent');
                this.playAudioBtn = document.getElementById('playAudio');
                this.testBtn = document.getElementById('testYourself');
                this.markCompleteBtn = document.getElementById('markComplete');
            }

            async loadLessonData() {
                try {
                    const response = await fetch('data.json');
                    const data = await response.json();
                    this.lessonData = data.consonants[this.vargaName];
                    this.totalLessons = this.lessonData.lessons.length;
                    this.generateAllLessons();
                    this.updateProgress();
                    this.updateLesson();
                } catch (error) {
                    console.error('Error loading lesson data:', error);
                    this.createFallbackLessons();
                }
            }

            generateAllLessons() {
                this.lessonContent.innerHTML = '';
                
                this.lessonData.lessons.forEach((lesson, index) => {
                    const slideElement = this.createLessonSlide(lesson, index === 0);
                    this.lessonContent.appendChild(slideElement);
                });

                // Add summary slide
                const summarySlide = this.createSummarySlide();
                this.lessonContent.appendChild(summarySlide);
            }

            createLessonSlide(lesson, isActive = false) {
                const slide = document.createElement('div');
                slide.className = `lesson-slide${isActive ? ' active' : ''}`;
                slide.setAttribute('data-lesson', lesson.id);

                const mouthPositionItems = this.generateMouthPositionItems(lesson.mouthPosition);
                const mistakesSection = lesson.commonMistakes ? this.generateMistakesSection(lesson.commonMistakes) : '';
                
                slide.innerHTML = `
                    <div class="letter-display">
                        <div class="main-letter">${lesson.letter}</div>
                        <div class="romanization">${lesson.romanization}</div>
                        <div class="sound-description">${lesson.soundDescription}</div>
                    </div>
                    
                    <div class="lesson-details">
                        <div class="mouth-position">
                            <h3>Mouth Position</h3>
                            <div class="position-grid">
                                ${mouthPositionItems}
                            </div>
                        </div>

                        <div class="practice-section">
                            <h3>Practice Words</h3>
                            <div class="practice-words">
                                ${lesson.practiceWords.map(word => `
                                    <div class="word-item">
                                        <span class="hindi">${word.hindi}</span>
                                        <span class="romanization">${word.romanization}</span>
                                        <span class="meaning">${word.meaning}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="tips-section">
                            <h3>Key Points</h3>
                            <ul>
                                ${lesson.keyPoints.map(point => `<li>${point}</li>`).join('')}
                            </ul>
                        </div>

                        ${mistakesSection}
                    </div>
                `;

                return slide;
            }

            generateMouthPositionItems(mouthPosition) {
                const items = [];
                
                if (mouthPosition.tongue) {
                    items.push(`<div class="position-item"><strong>Tongue:</strong> ${mouthPosition.tongue}</div>`);
                }
                if (mouthPosition.lips) {
                    items.push(`<div class="position-item"><strong>Lips:</strong> ${mouthPosition.lips}</div>`);
                }
                if (mouthPosition.jaw) {
                    items.push(`<div class="position-item"><strong>Jaw:</strong> ${mouthPosition.jaw}</div>`);
                }
                if (mouthPosition.airFlow) {
                    items.push(`<div class="position-item"><strong>Air Flow:</strong> ${mouthPosition.airFlow}</div>`);
                }
                if (mouthPosition.vocalCords) {
                    items.push(`<div class="position-item"><strong>Vocal Cords:</strong> ${mouthPosition.vocalCords}</div>`);
                }

                return items.join('');
            }

            generateMistakesSection(mistakes) {
                return `
                    <div class="mistakes-section">
                        <h3>Common Mistakes</h3>
                        <ul class="mistakes-list">
                            ${mistakes.map(mistake => `<li>${mistake}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            createSummarySlide() {
                const slide = document.createElement('div');
                slide.className = 'lesson-slide';
                slide.setAttribute('data-lesson', this.totalLessons + 1);

                slide.innerHTML = `
                    <div class="summary-content">
                        <h2>${this.lessonData.title}</h2>
                        <div class="consonant-chart-container">
                            <h3>Labial Series Overview</h3>
                            <div class="chart-visual">
                                <div class="consonant-series">
                                    <div class="series-row">
                                        <strong>Voiceless:</strong> ‡§™ (unaspirated) ‚Üí ‡§´ (aspirated)
                                    </div>
                                    <div class="series-row">
                                        <strong>Voiced:</strong> ‡§¨ (unaspirated) ‚Üí ‡§≠ (aspirated)
                                    </div>
                                    <div class="series-row">
                                        <strong>Nasal:</strong> ‡§Æ (voiced)
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="key-concepts">
                            <h3>Key Concepts</h3>
                            <div class="concept-grid">
                                <div class="concept-item">
                                    <strong>Easiest Series:</strong> Only lips involved, no tongue positioning needed
                                </div>
                                <div class="concept-item">
                                    <strong>Aspiration:</strong> ‡§™ vs ‡§´, ‡§¨ vs ‡§≠ - breath puff makes the difference
                                </div>
                                <div class="concept-item">
                                    <strong>Voicing:</strong> ‡§™/‡§´ (no vocal cords) vs ‡§¨/‡§≠ (vocal cords vibrate)
                                </div>
                            </div>
                        </div>

                        <div class="completion-badge">
                            <h3>üéâ Pa Varga Complete!</h3>
                            <p>You've mastered the labial consonants. Ready for the next series?</p>
                            <button class="action-btn" onclick="window.location.href='index.html'">Choose Next Varga</button>
                        </div>
                    </div>
                `;

                return slide;
            }

            createFallbackLessons() {
                this.lessonContent.innerHTML = `
                    <div class="lesson-slide active" data-lesson="1">
                        <div class="letter-display">
                            <div class="main-letter">‡§™</div>
                            <div class="romanization">pa</div>
                            <div class="sound-description">Voiceless bilabial stop</div>
                        </div>
                        <p>Loading lesson data...</p>
                    </div>
                `;
            }

            setupEventListeners() {
                this.prevBtn.addEventListener('click', () => this.previousLesson());
                this.nextBtn.addEventListener('click', () => this.nextLesson());
                this.playAudioBtn.addEventListener('click', () => this.playAudio());
                this.testBtn.addEventListener('click', () => this.openTest());
                this.markCompleteBtn.addEventListener('click', () => this.markComplete());
                
                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') this.previousLesson();
                    if (e.key === 'ArrowRight') this.nextLesson();
                    if (e.key === ' ') {
                        e.preventDefault();
                        this.playAudio();
                    }
                });
            }

            nextLesson() {
                if (this.currentLesson < this.totalLessons + 1) {
                    this.currentLesson++;
                    this.updateLesson();
                }
            }

            previousLesson() {
                if (this.currentLesson > 1) {
                    this.currentLesson--;
                    this.updateLesson();
                }
            }

            updateLesson() {
                const slides = document.querySelectorAll('.lesson-slide');
                slides.forEach(slide => slide.classList.remove('active'));
                
                const currentSlide = document.querySelector(`[data-lesson="${this.currentLesson}"]`);
                if (currentSlide) {
                    currentSlide.classList.add('active');
                }
                
                this.prevBtn.disabled = this.currentLesson === 1;
                this.nextBtn.disabled = this.currentLesson === this.totalLessons + 1;
                
                if (this.currentLesson <= this.totalLessons) {
                    this.lessonCounter.textContent = `${this.currentLesson} of ${this.totalLessons}`;
                } else {
                    this.lessonCounter.textContent = `Summary`;
                }
                
                this.updateProgress();
                this.updateCompletionStatus();
            }

            updateProgress() {
                const progressPercent = (this.currentLesson / (this.totalLessons + 1)) * 100;
                this.progressFill.style.width = `${progressPercent}%`;
            }

            updateCompletionStatus() {
                const isCompleted = this.completed.includes(this.currentLesson);
                this.markCompleteBtn.textContent = isCompleted ? '‚úì Completed' : '‚úì Mark Complete';
                this.markCompleteBtn.style.background = isCompleted ? 
                    'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)' : 
                    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            }

            markComplete() {
                if (!this.completed.includes(this.currentLesson)) {
                    this.completed.push(this.currentLesson);
                    localStorage.setItem(`completed_${this.vargaName}`, JSON.stringify(this.completed));
                    this.updateCompletionStatus();
                    this.showCompletionFeedback();
                }
            }

            showCompletionFeedback() {
                const feedback = document.createElement('div');
                feedback.className = 'completion-feedback';
                feedback.innerHTML = `
                    <div class="feedback-content">
                        <div class="feedback-icon">üéâ</div>
                        <div class="feedback-text">Lesson completed!</div>
                    </div>
                `;
                
                document.body.appendChild(feedback);
                
                setTimeout(() => {
                    feedback.classList.add('show');
                }, 100);
                
                setTimeout(() => {
                    feedback.classList.remove('show');
                    setTimeout(() => {
                        document.body.removeChild(feedback);
                    }, 300);
                }, 2000);
            }

            playAudio() {
                // Simple consonant audio synthesis
                this.synthesizeConsonantSound(this.currentLesson);
            }

            synthesizeConsonantSound(lessonNumber) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) {
                    alert('Audio synthesis not supported in this browser');
                    return;
                }

                const audioContext = new AudioContext();
                
                // Basic consonant + vowel synthesis
                const consonantFreqs = {
                    1: {type: 'stop', f: 100, aspiration: false}, // ‡§™
                    2: {type: 'stop', f: 100, aspiration: true},  // ‡§´
                    3: {type: 'stop', f: 100, voiced: true},      // ‡§¨
                    4: {type: 'stop', f: 100, voiced: true, aspiration: true}, // ‡§≠
                    5: {type: 'nasal', f: 150, voiced: true}      // ‡§Æ
                };

                const freq = consonantFreqs[lessonNumber];
                if (!freq) return;

                this.createConsonantSound(audioContext, freq);
            }

            createConsonantSound(audioContext, freq) {
                const duration = 0.8;
                
                // Create consonant burst
                const osc = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                osc.frequency.setValueAtTime(freq.f, audioContext.currentTime);
                osc.type = freq.type === 'nasal' ? 'sine' : 'square';
                
                // Quick burst for stop consonants
                if (freq.type === 'stop') {
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.05);
                    gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.1);
                } else {
                    // Sustained for nasal
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
                    gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + duration);
                }

                osc.connect(gainNode);
                gainNode.connect(audioContext.destination);

                osc.start(audioContext.currentTime);
                osc.stop(audioContext.currentTime + duration);

                // Add vowel sound after consonant
                setTimeout(() => {
                    this.addVowelSound(audioContext, 730, 1090); // 'a' vowel
                }, 100);

                this.showAudioFeedback();
            }

            addVowelSound(audioContext, f1, f2) {
                const duration = 0.5;
                const osc1 = audioContext.createOscillator();
                const osc2 = audioContext.createOscillator();
                const gain1 = audioContext.createGain();
                const gain2 = audioContext.createGain();

                osc1.frequency.setValueAtTime(f1, audioContext.currentTime);
                osc2.frequency.setValueAtTime(f2, audioContext.currentTime);
                osc1.type = osc2.type = 'sawtooth';

                gain1.gain.setValueAtTime(0.1, audioContext.currentTime);
                gain2.gain.setValueAtTime(0.05, audioContext.currentTime);

                osc1.connect(gain1);
                osc2.connect(gain2);
                gain1.connect(audioContext.destination);
                gain2.connect(audioContext.destination);

                osc1.start(audioContext.currentTime);
                osc2.start(audioContext.currentTime);
                osc1.stop(audioContext.currentTime + duration);
                osc2.stop(audioContext.currentTime + duration);
            }

            showAudioFeedback() {
                this.playAudioBtn.style.transform = 'scale(1.1)';
                this.playAudioBtn.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                
                setTimeout(() => {
                    this.playAudioBtn.style.transform = 'scale(1)';
                    this.playAudioBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }, 200);
            }

            openTest() {
                alert('Quiz functionality coming soon!');
            }
        }

        // Additional CSS for consonant-specific elements
        const consonantStyles = `
            .mistakes-section {
                background: #fef2f2;
                padding: 1.5rem;
                border-radius: 15px;
                border-left: 4px solid #ef4444;
                margin-top: 1rem;
            }

            .mistakes-section h3 {
                color: #ef4444;
                margin-bottom: 1rem;
                font-size: 1.3rem;
                font-weight: 600;
            }

            .mistakes-list {
                list-style: none;
                padding: 0;
            }

            .mistakes-list li {
                padding: 0.8rem;
                margin-bottom: 0.5rem;
                background: white;
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                position: relative;
                padding-left: 2.5rem;
            }

            .mistakes-list li::before {
                content: "‚ö†Ô∏è";
                position: absolute;
                left: 1rem;
                top: 50%;
                transform: translateY(-50%);
            }

            .consonant-series {
                background: white;
                padding: 2rem;
                border-radius: 10px;
            }

            .series-row {
                padding: 1rem;
                margin-bottom: 1rem;
                background: #f8f9ff;
                border-radius: 8px;
                font-size: 1.1rem;
            }

            .concept-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-top: 1rem;
            }

            .concept-item {
                padding: 1rem;
                background: white;
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }

            .concept-item strong {
                color: #667eea;
                display: block;
                margin-bottom: 0.5rem;
            }
        `;

        const styleSheet = document.createElement('style');
        styleSheet.textContent = consonantStyles;
        document.head.appendChild(styleSheet);

        // Initialize the consonant lesson navigator when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new ConsonantLessonNavigator('pa_varga');
        });
    </script>
</body>
</html>
