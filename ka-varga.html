<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ka Varga - Velar Consonants | Devanagari Learning Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="lesson.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="logo"><a href="index.html" style="color: white; text-decoration: none;">‡§¶‡•á‡§µ‡§®‡§æ‡§ó‡§∞‡•Ä Learning Hub</a></h1>
            <nav class="nav">
                <a href="index.html" class="nav-link">‚Üê Back to Home</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="lesson-header">
                <h1>Ka Varga - Velar Consonants (‡§ï ‡§µ‡§∞‡•ç‡§ó)</h1>
                <p class="lesson-subtitle">Master consonants made with the back of the tongue touching the soft palate</p>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" style="width: 0%"></div>
            </div>

            <nav class="lesson-nav">
                <button class="nav-btn" id="prevBtn" disabled>‚Üê Previous</button>
                <span class="lesson-counter">1 of 5</span>
                <button class="nav-btn" id="nextBtn">Next ‚Üí</button>
            </nav>

            <div class="lesson-content" id="lessonContent">
                <!-- Lessons will be dynamically loaded from data.json -->
            </div>

            <div class="lesson-footer">
                <button class="action-btn" id="playAudio">üîä Play Audio</button>
                <button class="action-btn" id="testYourself">üìù Test Yourself</button>
                <button class="action-btn" id="markComplete">‚úì Mark Complete</button>
            </div>
        </div>
    </main>

    <script>
        // Ka Varga Lesson Navigator
        class KaVargaLessonNavigator {
            constructor() {
                this.vargaName = 'ka_varga';
                this.currentLesson = 1;
                this.totalLessons = 5;
                this.completed = JSON.parse(localStorage.getItem(`completed_${this.vargaName}`) || '[]');
                this.lessonData = null;
                
                this.initializeElements();
                this.setupEventListeners();
                this.loadLessonData();
            }

            initializeElements() {
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.lessonCounter = document.querySelector('.lesson-counter');
                this.progressFill = document.querySelector('.progress-fill');
                this.lessonContent = document.getElementById('lessonContent');
                this.playAudioBtn = document.getElementById('playAudio');
                this.testBtn = document.getElementById('testYourself');
                this.markCompleteBtn = document.getElementById('markComplete');
            }

            async loadLessonData() {
                try {
                    const response = await fetch('data.json');
                    const data = await response.json();
                    this.lessonData = data.consonants[this.vargaName];
                    this.totalLessons = this.lessonData.lessons.length;
                    this.generateAllLessons();
                    this.updateProgress();
                    this.updateLesson();
                } catch (error) {
                    console.error('Error loading lesson data:', error);
                    this.createFallbackLessons();
                }
            }

            generateAllLessons() {
                this.lessonContent.innerHTML = '';
                
                // Create lessons from data
                this.lessonData.lessons.forEach((lesson, index) => {
                    const slideElement = this.createLessonSlide(lesson, index === 0);
                    this.lessonContent.appendChild(slideElement);
                });

                // Add remaining Ka Varga consonants with fallback data
                const additionalConsonants = [
                    {
                        id: this.lessonData.lessons.length + 1,
                        letter: "‡§ó",
                        romanization: "ga",
                        soundDescription: "Voiced velar stop",
                        mouthPosition: {
                            tongue: "Back part touches soft palate, vocal cords vibrate",
                            lips: "Neutral and relaxed",
                            jaw: "Slightly dropped, teeth apart",
                            airFlow: "Build pressure, gentle release, vocal cords vibrating",
                            vocalCords: "Vibrating (voiced)"
                        },
                        practiceWords: [
                            {"hindi": "‡§ó‡§æ‡§®‡§æ", "romanization": "gaana", "meaning": "song/to sing"},
                            {"hindi": "‡§ó‡§ø‡§≤‡§æ‡§∏", "romanization": "gilaas", "meaning": "glass"}
                        ],
                        keyPoints: [
                            "Same tongue position as ‡§ï but with voice",
                            "Vocal cords vibrate during articulation",
                            "Softer sound than ‡§ï",
                            "Very common in Hindi words"
                        ]
                    },
                    {
                        id: this.lessonData.lessons.length + 2,
                        letter: "‡§ò",
                        romanization: "gha",
                        soundDescription: "Aspirated voiced velar stop",
                        mouthPosition: {
                            tongue: "Same as ‡§ó",
                            lips: "Neutral",
                            jaw: "Same as ‡§ó",
                            airFlow: "Strong puff of air with vocal cord vibration",
                            vocalCords: "Vibrating"
                        },
                        practiceWords: [
                            {"hindi": "‡§ò‡§∞", "romanization": "ghar", "meaning": "house"},
                            {"hindi": "‡§ò‡§Ç‡§ü‡§æ", "romanization": "ghan·π≠aa", "meaning": "hour/bell"}
                        ],
                        keyPoints: [
                            "Same position as ‡§ó but with aspiration",
                            "Both voice and breath together",
                            "Strong puff of air after release",
                            "Less common than ‡§ó"
                        ]
                    },
                    {
                        id: this.lessonData.lessons.length + 3,
                        letter: "‡§ô",
                        romanization: "·πÖa",
                        soundDescription: "Velar nasal",
                        mouthPosition: {
                            tongue: "Back touches soft palate, air through nose",
                            lips: "Neutral",
                            jaw: "Relaxed",
                            airFlow: "Air flows through nose, not mouth",
                            vocalCords: "Vibrating"
                        },
                        practiceWords: [
                            {"hindi": "‡§Ö‡§Ç‡§ó‡•Ç‡§∞", "romanization": "anguur", "meaning": "grapes"},
                            {"hindi": "‡§ó‡§Ç‡§ó‡§æ", "romanization": "gangaa", "meaning": "Ganges river"}
                        ],
                        keyPoints: [
                            "Nasal sound - air through nose",
                            "Often appears in conjuncts",
                            "Like 'ng' in 'sing'",
                            "Continuous nasal sound"
                        ]
                    }
                ];

                // Add additional consonants
                additionalConsonants.forEach((lesson, index) => {
                    const slideElement = this.createLessonSlide(lesson, false);
                    this.lessonContent.appendChild(slideElement);
                });

                // Update total lessons count
                this.totalLessons = this.lessonData.lessons.length + additionalConsonants.length;

                // Add summary slide
                const summarySlide = this.createSummarySlide();
                this.lessonContent.appendChild(summarySlide);
            }

            createLessonSlide(lesson, isActive = false) {
                const slide = document.createElement('div');
                slide.className = `lesson-slide${isActive ? ' active' : ''}`;
                slide.setAttribute('data-lesson', lesson.id);

                const mouthPositionItems = this.generateMouthPositionItems(lesson.mouthPosition);
                const mistakesSection = lesson.commonMistakes ? this.generateMistakesSection(lesson.commonMistakes) : '';
                
                slide.innerHTML = `
                    <div class="letter-display">
                        <div class="main-letter">${lesson.letter}</div>
                        <div class="romanization">${lesson.romanization}</div>
                        <div class="sound-description">${lesson.soundDescription}</div>
                    </div>
                    
                    <div class="lesson-details">
                        <div class="mouth-position">
                            <h3>Mouth Position</h3>
                            <div class="position-grid">
                                ${mouthPositionItems}
                            </div>
                        </div>

                        <div class="practice-section">
                            <h3>Practice Words</h3>
                            <div class="practice-words">
                                ${lesson.practiceWords.map(word => `
                                    <div class="word-item">
                                        <span class="hindi">${word.hindi}</span>
                                        <span class="romanization">${word.romanization}</span>
                                        <span class="meaning">${word.meaning}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="tips-section">
                            <h3>Key Points</h3>
                            <ul>
                                ${lesson.keyPoints.map(point => `<li>${point}</li>`).join('')}
                            </ul>
                        </div>

                        ${mistakesSection}
                    </div>
                `;

                return slide;
            }

            generateMouthPositionItems(mouthPosition) {
                const items = [];
                
                if (mouthPosition.tongue) {
                    items.push(`<div class="position-item"><strong>Tongue:</strong> ${mouthPosition.tongue}</div>`);
                }
                if (mouthPosition.lips) {
                    items.push(`<div class="position-item"><strong>Lips:</strong> ${mouthPosition.lips}</div>`);
                }
                if (mouthPosition.jaw) {
                    items.push(`<div class="position-item"><strong>Jaw:</strong> ${mouthPosition.jaw}</div>`);
                }
                if (mouthPosition.airFlow) {
                    items.push(`<div class="position-item"><strong>Air Flow:</strong> ${mouthPosition.airFlow}</div>`);
                }
                if (mouthPosition.vocalCords) {
                    items.push(`<div class="position-item"><strong>Vocal Cords:</strong> ${mouthPosition.vocalCords}</div>`);
                }

                return items.join('');
            }

            generateMistakesSection(mistakes) {
                return `
                    <div class="mistakes-section">
                        <h3>Common Mistakes</h3>
                        <ul class="mistakes-list">
                            ${mistakes.map(mistake => `<li>${mistake}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            createSummarySlide() {
                const slide = document.createElement('div');
                slide.className = 'lesson-slide';
                slide.setAttribute('data-lesson', this.totalLessons + 1);

                slide.innerHTML = `
                    <div class="summary-content">
                        <h2>${this.lessonData.title}</h2>
                        <div class="consonant-chart-container">
                            <h3>Ka Varga Overview</h3>
                            <div class="chart-visual">
                                <div class="consonant-series">
                                    <div class="series-row">
                                        <strong>Voiceless:</strong> ‡§ï (unaspirated) ‚Üí ‡§ñ (aspirated)
                                    </div>
                                    <div class="series-row">
                                        <strong>Voiced:</strong> ‡§ó (unaspirated) ‚Üí ‡§ò (aspirated)
                                    </div>
                                    <div class="series-row">
                                        <strong>Nasal:</strong> ‡§ô (voiced nasal)
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="key-concepts">
                            <h3>Key Concepts</h3>
                            <div class="concept-grid">
                                <div class="concept-item">
                                    <strong>Articulation Place:</strong> Back of tongue touches soft palate (velum)
                                </div>
                                <div class="concept-item">
                                    <strong>Aspiration:</strong> ‡§ï vs ‡§ñ, ‡§ó vs ‡§ò - breath puff makes the difference
                                </div>
                                <div class="concept-item">
                                    <strong>Voicing:</strong> ‡§ï/‡§ñ (no vocal cords) vs ‡§ó/‡§ò (vocal cords vibrate)
                                </div>
                                <div class="concept-item">
                                    <strong>Nasal:</strong> ‡§ô allows air through nose while blocking mouth
                                </div>
                            </div>
                        </div>

                        <div class="completion-badge">
                            <h3>üéâ Ka Varga Complete!</h3>
                            <p>You've mastered all velar consonants. Ready for the next series?</p>
                            <button class="action-btn" onclick="window.location.href='index.html'">Choose Next Varga</button>
                        </div>
                    </div>
                `;

                return slide;
            }

            createFallbackLessons() {
                this.lessonContent.innerHTML = `
                    <div class="lesson-slide active" data-lesson="1">
                        <div class="letter-display">
                            <div class="main-letter">‡§ï</div>
                            <div class="romanization">ka</div>
                            <div class="sound-description">Voiceless velar stop</div>
                        </div>
                        <p>Loading lesson data...</p>
                    </div>
                `;
            }

            setupEventListeners() {
                this.prevBtn.addEventListener('click', () => this.previousLesson());
                this.nextBtn.addEventListener('click', () => this.nextLesson());
                this.playAudioBtn.addEventListener('click', () => this.playAudio());
                this.testBtn.addEventListener('click', () => this.openTest());
                this.markCompleteBtn.addEventListener('click', () => this.markComplete());
                
                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') this.previousLesson();
                    if (e.key === 'ArrowRight') this.nextLesson();
                    if (e.key === ' ') {
                        e.preventDefault();
                        this.playAudio();
                    }
                });
            }

            nextLesson() {
                if (this.currentLesson < this.totalLessons + 1) {
                    this.currentLesson++;
                    this.updateLesson();
                }
            }

            previousLesson() {
                if (this.currentLesson > 1) {
                    this.currentLesson--;
                    this.updateLesson();
                }
            }

            updateLesson() {
                const slides = document.querySelectorAll('.lesson-slide');
                slides.forEach(slide => slide.classList.remove('active'));
                
                const currentSlide = document.querySelector(`[data-lesson="${this.currentLesson}"]`);
                if (currentSlide) {
                    currentSlide.classList.add('active');
                }
                
                this.prevBtn.disabled = this.currentLesson === 1;
                this.nextBtn.disabled = this.currentLesson === this.totalLessons + 1;
                
                if (this.currentLesson <= this.totalLessons) {
                    this.lessonCounter.textContent = `${this.currentLesson} of ${this.totalLessons}`;
                } else {
                    this.lessonCounter.textContent = `Summary`;
                }
                
                this.updateProgress();
                this.updateCompletionStatus();
            }

            updateProgress() {
                const progressPercent = (this.currentLesson / (this.totalLessons + 1)) * 100;
                this.progressFill.style.width = `${progressPercent}%`;
            }

            updateCompletionStatus() {
                const isCompleted = this.completed.includes(this.currentLesson);
                this.markCompleteBtn.textContent = isCompleted ? '‚úì Completed' : '‚úì Mark Complete';
                this.markCompleteBtn.style.background = isCompleted ? 
                    'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)' : 
                    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            }

            markComplete() {
                if (!this.completed.includes(this.currentLesson)) {
                    this.completed.push(this.currentLesson);
                    localStorage.setItem(`completed_${this.vargaName}`, JSON.stringify(this.completed));
                    this.updateCompletionStatus();
                    this.showCompletionFeedback();
                }
            }

            showCompletionFeedback() {
                const feedback = document.createElement('div');
                feedback.className = 'completion-feedback';
                feedback.innerHTML = `
                    <div class="feedback-content">
                        <div class="feedback-icon">üéâ</div>
                        <div class="feedback-text">Lesson completed!</div>
                    </div>
                `;
                
                document.body.appendChild(feedback);
                
                setTimeout(() => {
                    feedback.classList.add('show');
                }, 100);
                
                setTimeout(() => {
                    feedback.classList.remove('show');
                    setTimeout(() => {
                        document.body.removeChild(feedback);
                    }, 300);
                }, 2000);
            }

            playAudio() {
                // Simple consonant audio synthesis for Ka Varga
                this.synthesizeConsonantSound(this.currentLesson);
            }

            synthesizeConsonantSound(lessonNumber) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) {
                    alert('Audio synthesis not supported in this browser');
                    return;
                }

                const audioContext = new AudioContext();
                
                // Ka Varga consonant frequencies and characteristics
                const consonantFreqs = {
                    1: {type: 'stop', f: 80, aspiration: false, voiced: false}, // ‡§ï
                    2: {type: 'stop', f: 80, aspiration: true, voiced: false},  // ‡§ñ
                    3: {type: 'stop', f: 80, aspiration: false, voiced: true},  // ‡§ó
                    4: {type: 'stop', f: 80, aspiration: true, voiced: true},   // ‡§ò
                    5: {type: 'nasal', f: 120, voiced: true}                   // ‡§ô
                };

                const freq = consonantFreqs[lessonNumber];
                if (!freq) return;

                this.createConsonantSound(audioContext, freq);
            }

            createConsonantSound(audioContext, freq) {
                const duration = freq.type === 'nasal' ? 1.0 : 0.8;
                
                // Create consonant burst
                const osc = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                osc.frequency.setValueAtTime(freq.f, audioContext.currentTime);
                osc.type = freq.type === 'nasal' ? 'sine' : 'square';
                
                if (freq.type === 'stop') {
                    // Quick burst for stop consonants
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.02);
                    gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.08);
                    
                    // Add aspiration if needed
                    if (freq.aspiration) {
                        setTimeout(() => {
                            const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.2, audioContext.sampleRate);
                            const noiseData = noiseBuffer.getChannelData(0);
                            for (let i = 0; i < noiseData.length; i++) {
                                noiseData[i] = (Math.random() * 2 - 1) * 0.1;
                            }
                            
                            const noiseSource = audioContext.createBufferSource();
                            const noiseGain = audioContext.createGain();
                            noiseSource.buffer = noiseBuffer;
                            noiseGain.gain.setValueAtTime(0.2, audioContext.currentTime);
                            noiseGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                            
                            noiseSource.connect(noiseGain);
                            noiseGain.connect(audioContext.destination);
                            noiseSource.start(audioContext.currentTime);
                        }, 80);
                    }
                } else {
                    // Sustained for nasal
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.1);
                    gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + duration);
                }

                osc.connect(gainNode);
                gainNode.connect(audioContext.destination);

                osc.start(audioContext.currentTime);
                osc.stop(audioContext.currentTime + duration);

                // Add vowel sound after consonant
                setTimeout(() => {
                    this.addVowelSound(audioContext, 730, 1090); // 'a' vowel
                }, 100);

                this.showAudioFeedback();
            }

            addVowelSound(audioContext, f1, f2) {
                const duration = 0.5;
                const osc1 = audioContext.createOscillator();
                const osc2 = audioContext.createOscillator();
                const gain1 = audioContext.createGain();
                const gain2 = audioContext.createGain();

                osc1.frequency.setValueAtTime(f1, audioContext.currentTime);
                osc2.frequency.setValueAtTime(f2, audioContext.currentTime);
                osc1.type = osc2.type = 'sawtooth';

                gain1.gain.setValueAtTime(0.1, audioContext.currentTime);
                gain2.gain.setValueAtTime(0.05, audioContext.currentTime);

                osc1.connect(gain1);
                osc2.connect(gain2);
                gain1.connect(audioContext.destination);
                gain2.connect(audioContext.destination);

                osc1.start(audioContext.currentTime);
                osc2.start(audioContext.currentTime);
                osc1.stop(audioContext.currentTime + duration);
                osc2.stop(audioContext.currentTime + duration);
            }

            showAudioFeedback() {
                this.playAudioBtn.style.transform = 'scale(1.1)';
                this.playAudioBtn.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                
                setTimeout(() => {
                    this.playAudioBtn.style.transform = 'scale(1)';
                    this.playAudioBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }, 200);
            }

            openTest() {
                alert('Quiz functionality coming soon!');
            }
        }

        // Additional CSS for Ka Varga specific elements
        const kaVargaStyles = `
            .mistakes-section {
                background: #fef2f2;
                padding: 1.5rem;
                border-radius: 15px;
                border-left: 4px solid #ef4444;
                margin-top: 1rem;
            }

            .mistakes-section h3 {
                color: #ef4444;
                margin-bottom: 1rem;
                font-size: 1.3rem;
                font-weight: 600;
            }

            .mistakes-list {
                list-style: none;
                padding: 0;
            }

            .mistakes-list li {
                padding: 0.8rem;
                margin-bottom: 0.5rem;
                background: white;
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                position: relative;
                padding-left: 2.5rem;
            }

            .mistakes-list li::before {
                content: "‚ö†Ô∏è";
                position: absolute;
                left: 1rem;
                top: 50%;
                transform: translateY(-50%);
            }

            .consonant-series {
                background: white;
                padding: 2rem;
                border-radius: 10px;
            }

            .series-row {
                padding: 1rem;
                margin-bottom: 1rem;
                background: #f8f9ff;
                border-radius: 8px;
                font-size: 1.1rem;
            }

            .concept-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-top: 1rem;
            }

            .concept-item {
                padding: 1rem;
                background: white;
                border-radius: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }

            .concept-item strong {
                color: #667eea;
                display: block;
                margin-bottom: 0.5rem;
            }

            .completion-feedback {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0);
                background: white;
                padding: 2rem;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                transition: all 0.3s ease;
            }

            .completion-feedback.show {
                transform: translate(-50%, -50%) scale(1);
            }

            .feedback-content {
                text-align: center;
            }

            .feedback-icon {
                font-size: 3rem;
                margin-bottom: 1rem;
            }

            .feedback-text {
                font-size: 1.2rem;
                color: #22c55e;
                font-weight: 600;
            }

            .completion-badge {
                background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
                color: white;
                padding: 2rem;
                border-radius: 15px;
                text-align: center;
                margin-top: 2rem;
            }

            .completion-badge h3 {
                margin-bottom: 1rem;
                font-size: 1.8rem;
            }

            .completion-badge p {
                margin-bottom: 1.5rem;
                opacity: 0.9;
            }
        `;

        const styleSheet = document.createElement('style');
        styleSheet.textContent = kaVargaStyles;
        document.head.appendChild(styleSheet);

        // Initialize the Ka Varga lesson navigator when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new KaVargaLessonNavigator();
        });
    </script>
</body>
</html>
